# coding: utf-8

import jack
import numpy as np
import spectrum

# Create client and inport
client = jack.Client("MyClient")
client.inports.register("input")

aud_buffer = np.array([])

@client.set_process_callback
def process(frames):
    global aud_buffer
    assert(frames == client.blocksize)
    aud_buffer = np.append(aud_buffer[client.blocksize:], client.inports[0].get_array())

def set_ms_delay(delay):
    global aud_buffer
    blocks_per_ms = client.samplerate / client.blocksize / 1000
    buffer_len = round(blocks_per_ms * delay * client.blocksize)
    aud_buffer = np.resize(aud_buffer, buffer_len)

set_ms_delay(32)
